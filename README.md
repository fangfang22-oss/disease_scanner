# 运行环境
python3 

### 爬虫
扫描医疗问答的爬虫文件为`scanner.py`，加入多线程后，爬虫隔一段时间效率会下降，甚至卡死，研究了半天也没什么好办法，所以又写了一个监控程序，也就是`monitor.py` ，它会每隔五秒钟看一下新增的数据，如果低于一定数量，就重启一次爬虫。
cut.py是词频分析统计程序，直接运行即可看到词频分析结果，可以根据自己的需求修改查询sql语句来获取不同的统计结果。

### jieba

使用jieba并结合语料库实现分词及词频统计。

jieba 词频统计的函数是 `jieba.analyse.extract_tags` 

```python
jieba.analyse.set_idf_path('dic_for_idf.txt') #配置自定义字典
tags = jieba.analyse.extract_tags(content, topK=200, withWeight=True)
```

但这样出现的结果很混乱，因为虽然配置了词频的字典，但是分词的时候会产生许多字典之外的词，他们也有权重，而且这些通用词出现频率更高，会完全压制自定义字典里的词，导致做词频统计，统计到的都不是自定义字典中的

所以我接下来加了一行代码，也同时配置了 jieba 分词的字典

```python
jieba.set_dictionary('dic_for_use.txt') #配置自定义字典
jieba.analyse.set_idf_path('dic_for_idf.txt') #配置自定义字典
tags = jieba.analyse.extract_tags(content, topK=200, withWeight=True)
```

但还是不行，网上找了资料，发现 jieba 其实还有新词发现功能，需要关闭隐马尔科夫模型，虽然```jieba.cut```可以配置隐马尔科夫模型的开关，但我调用的```jieba.analyse.extract_tags```却并没有这个参数，因此我只能修改 jieba 的源码，手动把 隐马尔科夫模型（HMM）给关闭了，修改的地方在 jieba库目录/posseg/__init__.py，搜索HMM就能找到许多，都改成False即可

为了保险起见，在`\Lib\site-packages\jieba\analyse\tfidf.py` 词频分析核心文件中的103行插入以下语句进行判断
```python
 if w not in self.idf_freq:
                continue
```
这样一来就可以完全过滤掉自定义字典之外的词

### 语料库
项目中收集了部分医疗相关的语料词典，可自行根据需求更改查询sql及引用的语料库实现不同类别的信息分析统计。

我发现[搜狗的词库](https://pinyin.sogou.com/dict/cate/index/132/download/9)真的是个很不错的地方，有许多医疗相关的语料，不过要注意的是，下载下来不能直接使用，需要使用工具解码，这里推荐『深蓝词库转换』，使用非常方便
![深蓝词库](https://img.niucodata.com/slck.png)

在结巴源码`tfida.py`文件中`extract_tags`函数中

`words = self.postokenizer.cut(sentence)`下插入
`wordsList=self.postokenizer.lcut(sentence)`

`for w in words:`里插入以下代码，显示分析进度。
```python
    #用于实时显示分析进度
    numTemp=numTemp+1
    precent=numTemp/len(wordsList)*100
    precent=round(precent,2)
    print("\r>>>分析进度: {}%".format(precent),end="")
```

### 20岁以下 （301359条）
```json
{'怀孕': 94254, '感冒': 47631, '手淫': 42025, '出血': 37095, '咳嗽': 22345, '狂犬病': 16158, '病毒感染': 15968, '阴道炎': 15945, '白癜风': 14781, '湿疹': 14324, '艾滋病': 14036, '消化不良': 11050, '呕吐': 11006, '痤疮': 10971, '癫痫': 10219, '鼻炎': 9603, '内分泌失调': 9378, '包皮过长': 9318, '皮肤病': 9296, '腹痛': 9257, '疲劳': 9064, '早泄': 8820, '腹泻': 8467, '毛囊炎': 8226, '皮炎': 8112, '上呼吸道感染': 8036, '流产': 7900, '肺炎': 7449, '胃炎': 7240, '荨麻疹': 6738, '前列腺炎': 6691, '肠炎': 6602, '水肿': 6548, '头痛': 6484, '贫血': 6462, '焦虑': 6345, '头晕': 6161, '性病': 5850, '皮疹': 5720, '气管炎': 5336, '痛经': 4927, '精神紧张': 4727, '抑郁症': 4622, '丘疹': 4600, '高热': 4578, '结膜炎': 4527, '鼻塞': 4245, '妇科检查': 4137, '疱疹': 4080, '淋巴结肿大': 4051, '白斑': 3946, '失眠': 3826, '水痘': 3810, '瘢痕': 3556, '包茎': 3467, '斜视': 3413, '痉挛': 3385, '脱发': 3375, '多动症': 3286, '破伤风': 3264, '呼吸道感染': 3213, '喉炎': 3194, '耳鸣': 3185, '鼻窦炎': 3169, '乏力': 3106, '粉刺': 3093, '尖锐湿疣': 3064, '尿道炎': 2969, '肛裂': 2937, '神经衰弱': 2817, '冻疮': 2811, '龟头炎': 2725, '红斑': 2706, '龋齿': 2674, '糖尿病': 2604, '咽炎': 2563, '心理治疗': 2465, '营养不良': 2446, '雀斑': 2439, '麦粒肿': 2420, '支原体感染': 2392, '中耳炎': 2379, '散光': 2341, '排卵期出血': 2271, '梅毒': 2227, '月经失调': 2185, '牙龈炎': 2173, '鸡眼': 2144, '综合征': 2128, '疥疮': 1957, '脂溢性皮炎': 1897, '血管瘤': 1871, '哮喘': 1846, '高血压': 1824, '外阴炎': 1821, '过敏性紫癜': 1808, '胃肠功能紊乱': 1789, '抽搐': 1779, '肝病': 1760, '阑尾炎': 1760, '阴道出血': 1760, '人工流产': 1744, '乳腺增生': 1735, '血管扩张': 1732, '急性胃肠炎': 1719, '舌苔': 1713, '包皮龟头炎': 1697, '呼吸困难': 1681, '口臭': 1649, '脓肿': 1576, '胸闷': 1503, '肠痉挛': 1453, '血尿': 1449, '喷嚏': 1427, '牛皮癣': 1405, '胃痛': 1405, '胃病': 1395, '闭经': 1383, '遗尿': 1380, '慢性咽炎': 1364, '灰指甲': 1354, '尿痛': 1342, '腺样体肥大': 1338, '腰痛': 1319, '嗜睡': 1281, '便血': 1237, '淋巴结炎': 1224, '保留': 1218, '屈光不正': 1202, '股癣': 1196, '先天性心脏病': 1177, '腰肌劳损': 1173, '紫癜': 1170, '心肌炎': 1164, '牙髓炎': 1164, '银屑病': 1164, '远视': 1145, '牙周炎': 1123, '慢性胃炎': 1119, '带状疱疹': 1113, '滑膜炎': 1113, '低血压': 1104, '脂肪瘤': 1100, '病毒性感冒': 1094, '肝炎': 1088, '子宫内膜炎': 1081, '维生素缺乏': 1081, '冻伤': 1062, '心律失常': 1062, '黄疸': 1056, '先兆流产': 1018, '子宫内膜异位': 1012, '睾丸炎': 996, '胸痛': 964, '角膜炎': 954, '皮肤感染': 942, '眼疲劳': 939, '过分担心': 923, '牙痛': 920, '心脏病': 913, '精索静脉曲张': 913, '脑炎': 897, '白血病': 888, '鞘膜积液': 875, '包皮炎': 872, '内痔': 866, '慢性鼻炎': 856, '偏头痛': 853, '急性胃炎': 834, '唇炎': 824, '盗汗': 818, '眩晕': 812, '外痔': 812, '麻疹': 809, '细菌性感染': 809, '耳聋': 799, '高热惊厥': 799, '胃溃疡': 799, '消瘦': 796, '肠系膜淋巴结炎': 796, '扁平疣': 796, '食欲不振': 790, '性早熟': 786, '寻常疣': 783, '惊厥': 770, '心悸': 764, '白带异常': 761, '咽痛': 761, '精神分裂症': 748, '发育迟缓': 745, '精囊炎': 739, '支气管肺炎': 732, '植物神经功能紊乱': 713, '精神病': 701, '胆囊炎': 697, '肺部感染': 697, '接触性皮炎': 694, '斑秃': 694, '扁桃体肥大': 691, '肋间神经痛': 688}

```




# 运行环境
python3 

### 爬虫
扫描医疗问答的爬虫文件为`scanner.py`，加入多线程后，爬虫隔一段时间效率会下降，甚至卡死，研究了半天也没什么好办法，所以又写了一个监控程序，也就是`monitor.py` ，它会每隔五秒钟看一下新增的数据，如果低于一定数量，就重启一次爬虫。
cut.py是词频分析统计程序，直接运行即可看到词频分析结果，可以根据自己的需求修改查询sql语句来获取不同的统计结果。

### jieba

使用jieba并结合语料库实现分词及词频统计。

jieba 词频统计的函数是 `jieba.analyse.extract_tags` 

```python
jieba.analyse.set_idf_path('dic_for_idf.txt') #配置自定义字典
tags = jieba.analyse.extract_tags(content, topK=200, withWeight=True)
```

但这样出现的结果很混乱，因为虽然配置了词频的字典，但是分词的时候会产生许多字典之外的词，他们也有权重，而且这些通用词出现频率更高，会完全压制自定义字典里的词，导致做词频统计，统计到的都不是自定义字典中的

所以我接下来加了一行代码，也同时配置了 jieba 分词的字典

```python
jieba.set_dictionary('dic_for_use.txt') #配置自定义字典
jieba.analyse.set_idf_path('dic_for_idf.txt') #配置自定义字典
tags = jieba.analyse.extract_tags(content, topK=200, withWeight=True)
```

但还是不行，网上找了资料，发现 jieba 其实还有新词发现功能，需要关闭隐马尔科夫模型，虽然```jieba.cut```可以配置隐马尔科夫模型的开关，但我调用的```jieba.analyse.extract_tags```却并没有这个参数，因此我只能修改 jieba 的源码，手动把 隐马尔科夫模型（HMM）给关闭了，修改的地方在 jieba库目录/posseg/__init__.py，搜索HMM就能找到许多，都改成False即可

为了保险起见，在`\Lib\site-packages\jieba\analyse\tfidf.py` 词频分析核心文件中的103行插入以下语句进行判断
```python
 if w not in self.idf_freq:
                continue
```
这样一来就可以完全过滤掉自定义字典之外的词

### 语料库
项目中收集了部分医疗相关的语料词典，可自行根据需求更改查询sql及引用的语料库实现不同类别的信息分析统计。

我发现[搜狗的词库](https://pinyin.sogou.com/dict/cate/index/132/download/9)真的是个很不错的地方，有许多医疗相关的语料，不过要注意的是，下载下来不能直接使用，需要使用工具解码，这里推荐『深蓝词库转换』，使用非常方便
![深蓝词库](https://img.niucodata.com/slck.png)

在结巴源码`tfida.py`文件中`extract_tags`函数中

`words = self.postokenizer.cut(sentence)`下插入
`wordsList=self.postokenizer.lcut(sentence)`

`for w in words:`里插入以下代码，显示分析进度。
```python
    #用于实时显示分析进度
    numTemp=numTemp+1
    precent=numTemp/len(wordsList)*100
    precent=round(precent,2)
    print("\r>>>分析进度: {}%".format(precent),end="")
```

### 20岁以下 （301359条）
```json
{'怀孕': 92714, '感冒': 46853, '手淫': 41338, '出血': 36488, '咳嗽': 21980, '多饮': 16343, '狂犬病': 15894, '病毒感染': 15707, '阴道炎': 15685, '白癜风': 14540, '湿疹': 14090, '艾滋病': 13806, '消化不良': 10869, '呕吐': 10826, '痤疮': 10791, '癫痫': 10052, '鼻炎': 9446, '内分泌失调': 9225, '包皮过长': 9165, '皮肤病': 9144, '腹痛': 9106, '疲劳': 8916, '早泄': 8675, '腹泻': 8329, '毛囊炎': 8092, '皮炎': 7980, '上呼吸道感染': 7905, '流产': 7770, '肺炎': 7327, '胃炎': 7121, '荨麻疹': 6628, '前列腺炎': 6581, '肠炎': 6494, '水肿': 6441, '头痛': 6379, '贫血': 6357, '焦虑': 6241, '头晕': 6060, '性病': 5754, '皮疹': 5626, '气管炎': 5249, '痛经': 4846, '精神紧张': 4650, '抑郁症': 4547, '丘疹': 4525, '高热': 4503, '结膜炎': 4453, '鼻塞': 4175, '妇科检查': 4069, '疱疹': 4013, '淋巴结肿大': 3985, '白斑': 3882, '失眠': 3763, '水痘': 3748, '瘢痕': 3498, '包茎': 3411, '斜视': 3358, '痉挛': 3329, '脱发': 3320, '多动症': 3233, '破伤风': 3211, '呼吸道感染': 3161, '喉炎': 3142, '耳鸣': 3133, '鼻窦炎': 3117, '乏力': 3055, '粉刺': 3042, '尖锐湿疣': 3014, '尿道炎': 2921, '肛裂': 2889, '神经衰弱': 2771, '冻疮': 2765, '龟头炎': 2680, '红斑': 2662, '龋齿': 2630, '糖尿病': 2562, '咽炎': 2521, '心理治疗': 2424, '营养不良': 2406, '雀斑': 2399, '麦粒肿': 2381, '支原体感染': 2353, '中耳炎': 2340, '散光': 2303, '排卵期出血': 2234, '梅毒': 2190, '月经失调': 2150, '牙龈炎': 2137, '鸡眼': 2109, '综合征': 2094, '疥疮': 1925, '脂溢性皮炎': 1866, '血管瘤': 1841, '哮喘': 1816, '高血压': 1794, '外阴炎': 1791, '过敏性紫癜': 1778, '胃肠功能紊乱': 1760, '抽搐': 1750, '肝病': 1732, '阑尾炎': 1732, '阴道出血': 1732, '人工流产': 1716, '乳腺增生': 1707, '血管扩张': 1703, '急性胃肠炎': 1691, '舌苔': 1685, '包皮龟头炎': 1669, '呼吸困难': 1654, '口臭': 1622, '脓肿': 1551, '胸闷': 1479, '肠痉挛': 1429, '血尿': 1426, '喷嚏': 1404, '牛皮癣': 1382, '胃痛': 1382, '胃病': 1373, '闭经': 1360, '遗尿': 1357, '慢性咽炎': 1341, '灰指甲': 1332, '尿痛': 1320, '腺样体肥大': 1316, '腰痛': 1298, '嗜睡': 1260, '便血': 1217, '淋巴结炎': 1204, '保留': 1198, '屈光不正': 1182, '股癣': 1176, '先天性心脏病': 1157, '腰肌劳损': 1154, '紫癜': 1151, '心肌炎': 1145, '牙髓炎': 1145, '银屑病': 1145, '远视': 1126, '牙周炎': 1104, '慢性胃炎': 1101, '带状疱疹': 1095, '滑膜炎': 1095, '低血压': 1086, '脂肪瘤': 1082, '病毒性感冒': 1076, '肝炎': 1070, '子宫内膜炎': 1064, '维生素缺乏': 1064, '冻伤': 1045, '心律失常': 1045, '黄疸': 1039, '先兆流产': 1001, '子宫内膜异位': 995, '睾丸炎': 979, '胸痛': 948, '角膜炎': 939, '皮肤感染': 926, '眼疲劳': 923, '过分担心': 908, '牙痛': 905, '心脏病': 898, '精索静脉曲张': 898, '脑炎': 883, '白血病': 873, '鞘膜积液': 861, '包皮炎': 858, '内痔': 851, '慢性鼻炎': 842, '偏头痛': 839, '急性胃炎': 820, '唇炎': 811, '盗汗': 805, '眩晕': 798, '外痔': 798, '麻疹': 795, '细菌性感染': 795, '耳聋': 786, '高热惊厥': 786, '胃溃疡': 786, '消瘦': 783, '肠系膜淋巴结炎': 783, '扁平疣': 783, '食欲不振': 777, '性早熟': 773, '寻常疣': 770, '惊厥': 758, '心悸': 752, '白带异常': 749, '咽痛': 749, '精神分裂症': 736, '发育迟缓': 733, '精囊炎': 727, '支气管肺炎': 720, '植物神经功能紊乱': 702, '精神病': 689, '胆囊炎': 686, '肺部感染': 686, '接触性皮炎': 683, '斑秃': 683, '扁桃体肥大': 680}

```



